# 34. الأرشيف: نموذج `ArchivedRecord`

يعمل نموذج `ArchivedRecord` بمثابة "مقبرة" أو أرشيف للسجلات التي تم حذفها نهائيًا باستخدام استراتيجية الحذف الدائم (`force_delete`). الغرض منه هو توفير نسخة احتياطية أخيرة من البيانات المحذوفة للرجوع إليها عند الحاجة.

## كيف يعمل؟

عندما يتم استدعاء `service.force_delete(id)`، يقوم `BaseRepository` تلقائيًا بإنشاء سجل `ArchivedRecord` جديد يحتوي على نسخة كاملة من بيانات السجل الأصلي، ثم يقوم بحذف السجل الأصلي من جدوله.

## حقول النموذج

يتم تخزين هذه السجلات في جدول `archived_records` وتحتوي على الحقول التالية:

- **`id: Column(INTEGER, ...)`**
  - **الوصف:** المفتاح الأساسي لسجل الأرشيف نفسه.

- **`original_table: Column(String, ...)`**
  - **الوصف:** اسم الجدول الذي كان السجل الأصلي ينتمي إليه (e.g., `"users"`, `"products"`).

- **`original_pk: Column(Text, ...)`**
  - **الوصف:** المفتاح الأساسي الذي كان لدى السجل في جدوله الأصلي. يتم تخزينه كنص ليكون متوافقًا مع جميع أنواع المفاتيح.

- **`data: Column(JSON, ...)`**
  - **الوصف:** هذا هو الحقل الأهم. يحتوي على لقطة (snapshot) كاملة بصيغة JSON لبيانات السجل كما كانت لحظة حذفه.

- **`archived_at: Column(TIMESTAMP, ...)`**
  - **الوصف:** الطابع الزمني الذي تمت فيه أرشفة وحذف السجل.

### مثال على سجل مؤرشف

إذا قمت بحذف منتج بشكل دائم، فقد يبدو السجل المقابل في جدول `archived_records` كما يلي:

```json
{
  "id": 1,
  "original_table": "products",
  "original_pk": "123",
  "archived_at": "2025-09-24T20:30:00Z",
  "data": {
    "id": 123,
    "uuid": "prod-uuid-123",
    "name": "Discontinued Product",
    "price": 49.99,
    "created_at": "2024-01-01T12:00:00Z",
    "updated_at": "2024-06-01T18:00:00Z"
  }
}
```

## الغرض والقيود

- **الغرض:** يستخدم هذا الجدول بشكل أساسي للمراجعة اليدوية، أو التدقيق طويل الأمد، أو في حالات استعادة البيانات بعد الكوارث (disaster recovery) حيث قد تحتاج إلى استعادة سجل تم حذفه عن طريق الخطأ بشكل دائم.
- **القيود:** لا توجد وظيفة مدمجة "لإلغاء أرشفة" أو استعادة سجل تلقائيًا من هذا الجدول. ستكون عملية الاستعادة عملية يدوية، حيث قد يتطلب الأمر التعامل مع العلاقات وقواعد العمل المعقدة.
