# 23. أوامر واجهة سطر الأوامر (CLI)

توفر `Flask-DevKit` مجموعة من الأوامر المساعدة التي يتم دمجها مع واجهة سطر أوامر `flask` لتسهيل إدارة قاعدة البيانات والإعداد الأولي.

---

## `flask devkit-init-db`

- **الغرض:** إنشاء جميع جداول قاعدة البيانات.
- **الوصف:** يقوم هذا الأمر بفحص جميع نماذج `SQLAlchemy` المسجلة في تطبيقك (بما في ذلك نماذج `DevKit` ونماذجك المخصصة) وينشئ الجداول المقابلة لها في قاعدة البيانات.
- **متى يُستخدم:** يجب تشغيله عند إعداد قاعدة بيانات جديدة لأول مرة.

```bash
# سيقوم بإنشاء الجداول users, roles, permissions, etc.
flask devkit-init-db

# Output:
# Initialized the database.
```

---

## `flask devkit-truncate-db`

- **الغرض:** حذف جميع البيانات من جميع الجداول.
- **الوصف:** يقوم هذا الأمر بتفريغ (TRUNCATE) جميع الجداول في قاعدة البيانات، مع التعامل مع قيود المفاتيح الخارجية (foreign key constraints) بشكل صحيح. الجداول نفسها تبقى موجودة، ولكنها تصبح فارغة.
- **متى يُستخدم:** مفيد جدًا أثناء التطوير عندما تريد إعادة تعيين حالة قاعدة البيانات بسرعة دون الحاجة إلى حذفها وإعادة إنشائها.

```bash
flask devkit-truncate-db

# Output:
# Truncated table: devkit_audit_log
# Truncated table: role_permissions
# ...
# All tables have been truncated.
```

---

## `flask devkit-drop-db`

- **الغرض:** حذف قاعدة البيانات بأكملها.
- **الوصف:** هذا إجراء تدميري. بالنسبة لـ `SQLite`، سيقوم بحذف ملف قاعدة البيانات. بالنسبة لـ `MySQL`، سيقوم بحذف الـ schema بالكامل (بعد طلب تأكيد).
- **تحذير:** **هذا الإجراء لا يمكن التراجع عنه.** استخدمه بحذر شديد.

```bash
flask devkit-drop-db
```

---

## `flask devkit-seed`

- **الغرض:** ملء قاعدة البيانات بالبيانات الأولية اللازمة لعمل نظام المصادقة.
- **الوصف:** هذا أمر حيوي يجب تشغيله بعد `init-db`. يقوم بالآتي:
  1.  إنشاء جميع الصلاحيات الافتراضية (e.g., `create:user`, `read:role`).
  2.  إنشاء دور نظام `admin` ومنحه جميع الصلاحيات.
  3.  إنشاء مستخدم مسؤول أول وتعيين دور `admin` له.
- **الخيارات:**
  - `--admin-username`: لتحديد اسم المستخدم للمسؤول (الافتراضي: `admin`).
  - `--admin-password`: لتحديد كلمة المرور مباشرة في الأمر. إذا تم حذفه، سيطلب منك إدخال كلمة المرور بشكل تفاعلي وآمن.

### مثال على الاستخدام

```bash
# استخدام القيم الافتراضية وكلمة مرور تفاعلية
flask devkit-seed

# تحديد اسم مستخدم وكلمة مرور مخصصين
flask devkit-seed --admin-username=bahaa --admin-password=a-very-strong-password
```

### سير العمل النموذجي لإعداد جديد

1.  `flask devkit-init-db`
2.  `flask devkit-seed`
