# مشروع عرض DevKit

هذا المشروع هو عرض شامل لميزات مكتبة `flask-devkit`، حيث يوضح ميزاتها المتقدمة والقابلة للتوسعة في واجهة برمجة تطبيقات (API) بسيطة تشبه المدونة.

يعمل هذا المشروع كدليل عملي وقالب لبناء تطبيقاتك الخاصة باستخدام DevKit.

## جولة في الميزات

تم تكوين هذا المشروع بشكل صريح لإظهار قوة `flask-devkit`. إليك جولة في ما يجب البحث عنه في الكود:

-   **مصنع التطبيق المركزي (`showcase_app/__init__.py`)**
    -   يعرض النمط الموصى به لتهيئة `flask-devkit` ومكوناتها.
    -   يوضح كيفية تسجيل المخططات (blueprints) الخاصة بالتطبيق جنبًا إلى جنب مع مخططات DevKit.

-   **المستودع المخصص (`showcase_app/repositories/user.py`)**
    -   `CustomUserRepository` يرث من `BaseRepository` لإضافة دالة جديدة، `count_active_users`.
    -   يتم تسجيل هذا الكلاس المخصص مع `DevKit` في مصنع التطبيق، مما يعرض ميزة **استبدال المستودعات**.

-   **خدمة مخصصة مع هوكات (`showcase_app/services/post.py`)**
    -   `PostService` يرث من `BaseService`.
    -   يستخدم `pre_create_hook` لتعيين مؤلف المقال تلقائيًا من JWT.
    -   يستخدم `post_get_hook` و `post_list_hook` لإضافة حقل محسوب `read_time_minutes` ديناميكيًا إلى المقالات عند جلبها، مما يعرض ميزة **هوكات قراءة الخدمات**.

-   **مسارات مخصصة و CRUD (`showcase_app/routes/post.py`)**
    -   يوضح استخدام `register_crud_routes` لإنشاء مجموعة كاملة من نقاط النهاية لنموذج `Post`.
    -   يعرض كيفية استخدام المساعد `register_custom_route` لإضافة نقطة نهاية نظيفة ومخصصة وخالية من التكرار (`/posts/meta/stats`)، مما يعرض **مولد المسارات المخصصة**.

-   **أوامر CLI مخصصة (`showcase_app/cli.py`)**
    -   يتضمن عدة أوامر مخصصة لإدارة قاعدة البيانات: `init-db`، `truncate-db`، و `drop-db` (مع دعم SQLite و MySQL).

## إعداد المشروع

1.  **تثبيت الاعتماديات:**
    تأكد من أن [Poetry](https://python-poetry.org/) مثبت لديك.

    ```bash
    poetry install
    ```

2.  **متغيرات البيئة:**
    انسخ ملف `.env.example` إلى ملف جديد باسم `.env`. يتم تحميل هذا الملف تلقائيًا عند تشغيل أوامر `flask`.

    ```bash
    cp .env.example .env
    ```
    *يوصى بشدة بتغيير `FLASK_JWT_SECRET_KEY` في ملف `.env` الجديد.*

3.  **تهيئة وإضافة البيانات الأولية لقاعدة البيانات:**
    قم بتشغيل الأوامر التالية لإنشاء جداول قاعدة البيانات وتعبئتها بالأدوار والصلاحيات الافتراضية، بالإضافة إلى مستخدم مسؤول.

    ```bash
    # إنشاء قاعدة البيانات والجداول
    poetry run flask init-db

    # إضافة البيانات الأولية مع مستخدم مسؤول
    poetry run flask devkit-seed --admin-username admin --admin-password your_chosen_password
    ```

## تشغيل التطبيق

```bash
poetry run flask run
```

سيصبح الـ API متاحًا على `http://127.0.0.1:5000`.

### توثيق الـ API (Swagger UI)

يستخدم هذا المشروع `APIFlask`، الذي يقوم تلقائيًا بإنشاء توثيق تفاعلي للـ API باستخدام Swagger UI.

بمجرد تشغيل التطبيق، يمكنك الوصول إلى التوثيق عبر الانتقال إلى:

**http://127.0.0.1:5000/docs**

من هناك، يمكنك عرض جميع المسارات المتاحة واختبارها مباشرة من متصفحك.

## أوامر CLI المخصصة

يتضمن هذا المشروع أوامر مفيدة لإدارة قاعدة بياناتك أثناء التطوير.

-   **`poetry run flask truncate-db`**: يحذف جميع البيانات من كافة الجداول، مع ترك الهيكل سليمًا.
-   **`poetry run flask drop-db`**: يحذف ملف قاعدة البيانات بالكامل (SQLite) أو المخطط (MySQL). **استخدمه بحذر.**

## تشغيل الاختبارات

```bash
poetry run pytest
```